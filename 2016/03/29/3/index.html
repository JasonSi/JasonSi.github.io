<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Mr. Almost"><title>Ruby+Tesseract爬取学校教务系统 | Pujiaxun的空间</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.1.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-113942183-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Ruby+Tesseract爬取学校教务系统</h1><a id="logo" href="/.">Pujiaxun的空间</a><p class="description">开始时捱一些苦，栽种绝处的花～</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Ruby+Tesseract爬取学校教务系统</h1><div class="post-meta">Mar 29, 2016<span> | </span><span class="category"><a href="/categories/tech/">技术</a></span></div><a class="disqus-comment-count" href="/2016/03/29/3/#vcomment"><span class="valine-comment-count" data-xid="/2016/03/29/3/"></span><span>条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#初衷"><span class="toc-number">1.</span> <span class="toc-text">初衷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模拟登录"><span class="toc-number">2.</span> <span class="toc-text">模拟登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分析教务系统登录页面"><span class="toc-number">2.1.</span> <span class="toc-text">分析教务系统登录页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开始模拟登录"><span class="toc-number">2.2.</span> <span class="toc-text">开始模拟登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动识别验证码"><span class="toc-number">3.</span> <span class="toc-text">自动识别验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可行性"><span class="toc-number">3.1.</span> <span class="toc-text">可行性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装RTesseract"><span class="toc-number">3.2.</span> <span class="toc-text">安装RTesseract</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OCR识别"><span class="toc-number">3.3.</span> <span class="toc-text">OCR识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提高识别率"><span class="toc-number">3.4.</span> <span class="toc-text">提高识别率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#干掉空格"><span class="toc-number">3.4.1.</span> <span class="toc-text">干掉空格</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#限定识别范围"><span class="toc-number">3.4.2.</span> <span class="toc-text">限定识别范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#判定长度"><span class="toc-number">3.4.3.</span> <span class="toc-text">判定长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理图像"><span class="toc-number">3.4.4.</span> <span class="toc-text">处理图像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取成绩"><span class="toc-number">4.</span> <span class="toc-text">获取成绩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取指定页面"><span class="toc-number">4.1.</span> <span class="toc-text">获取指定页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解析结果"><span class="toc-number">4.2.</span> <span class="toc-text">解析结果</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="初衷"><a href="#初衷" class="headerlink" title="初衷"></a>初衷</h2><p>大一下学期期末只剩下高数考试时，考前时间比较充裕，想自学Java，同时还看了很多爬虫的故事，那是我第一次知道这么个词。<br>于是我决定利用Java来自动获取我的成绩，一是为了学Java，二来可以快速知道自己的成绩。</p>
<p>当时连续三天，白天睡觉晚上通宵，因为晚上安静很适合思考。利用Java丰富的第三方jar包，实现模拟登录，顺便查到Tesseract这个东西，还 <del>抄</del> 写了一个发送邮件的类。东拼西凑总算是实现了自己后台定时爬成绩的功能，有更新则邮件通知我。当时心里爽的不行，觉得编程的世界简直酷炫。所以就转专业到CS，入了大坑～</p>
<p>后来学了Ruby，于是还想通过Ruby再实现一次，毕竟当年写的Java代码我自己现在也不认识了。</p>
<p>废话又说一大堆，我们开始吧～</p>
<h2 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h2><hr>
<h3 id="分析教务系统登录页面"><a href="#分析教务系统登录页面" class="headerlink" title="分析教务系统登录页面"></a>分析教务系统登录页面</h3><p>教务系统的真实网址是</p>
<blockquote>
<p><a href="http://202.119.113.135/loginAction.do" target="_blank" rel="noopener">http://202.119.113.135/loginAction.do</a></p>
</blockquote>
<p>这个教务系统的登录界面比较简单，就一个表单，丑的我难受那种。<br><img src="http://upload-images.jianshu.io/upload_images/703144-39b53e43099ce1a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="登录界面"><br>我们可以看到有账号，密码，验证码三个输入框。打开审查元素（F12），可以找到如下结构：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/703144-f33275101211d0e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="登录界面的DOM"></p>
<p>图片可能看不清，部分代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"6"</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">class</span>=<span class="string">"font-b"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span> <span class="attr">width</span>=<span class="string">"67"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"userName_label"</span>&gt;</span>帐号<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"zjh"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"input01"</span> <span class="attr">title</span>=<span class="string">"帐号"</span> <span class="attr">alt</span>=<span class="string">"notnull"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span> <span class="attr">width</span>=<span class="string">"67"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"password_label"</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">span</span>&gt;</span>: <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"mm"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"input01"</span> <span class="attr">title</span>=<span class="string">"密码"</span> <span class="attr">alt</span>=<span class="string">"notnull"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span> <span class="attr">width</span>=<span class="string">"67"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"password_label"</span>&gt;</span>验证码<span class="tag">&lt;/<span class="name">span</span>&gt;</span>:</span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"2"</span> <span class="attr">align</span>=<span class="string">"left"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"v_yzm"</span> <span class="attr">size</span>=<span class="string">"4"</span> <span class="attr">title</span>=<span class="string">"验证码"</span> <span class="attr">alt</span>=<span class="string">"notnull"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"vchart"</span> <span class="attr">height</span>=<span class="string">"20"</span> <span class="attr">width</span>=<span class="string">"80"</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">onclick</span>=<span class="string">"m_changeOne();"</span>&gt;</span>看不清，换一张<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>很容易就可以发现账号的name属性是”zjh”，密码的name是”mm”，验证码的name是”v_yzm”，所以我们只需要填写对应字段并提交即可。</p>
<p>可是验证码怎么获取呢？</p>
<p>这个问题我也困扰了一下，直到发现下面这个属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src="/validateCodeAction.do?random=0.30715287429191673"</span><br></pre></td></tr></table></figure>
<p>上面是个相对路径，所以只要加上IP，即访问如下网址(可点击)，就可以获取验证码。</p>
<blockquote>
<p><a href="http://202.119.113.135/validateCodeAction.do?random=0.30715287429191673" target="_blank" rel="noopener">http://202.119.113.135/validateCodeAction.do?random=0.30715287429191673</a></p>
</blockquote>
<p>当时我也不知道那一串破数字是干嘛使的，先实现功能重要，就从网页源代码里复制下来了。</p>
<p>然后用内置方法把这个下载下来，并且保存为图片格式，于是验证码就到了本地，手动填写验证码后尝试登录。具体实现稍后放代码。</p>
<p>后来啊，我终于发现了后面那串莫名其妙的数字是哪里来的！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">m_changeOne</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"vchart"</span>).src=<span class="string">"/validateCodeAction.do?random="</span>+<span class="built_in">Math</span>.random();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">valiCode</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"vchart"</span>).src=<span class="string">"/validateCodeAction.do?random="</span>+<span class="built_in">Math</span>.random();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然我也不知道这两个函数体内容有什么区别，但是我知道了那就是个随机数，我猜0~1数字都可以成功，并且试了一下还真是。</p>
<p>到这里我们分析完登录页面，就开始模拟登录吧。接下来就是想办法把该填的字段打包好POST到服务器。</p>
<h3 id="开始模拟登录"><a href="#开始模拟登录" class="headerlink" title="开始模拟登录"></a>开始模拟登录</h3><p>接下来就是介绍<strong>Ruby</strong>(Version: 2.2.2)的<strong>Mechanize</strong>(Version: 2.7.4)，这个gem非常良心，写出来代码简洁大方。首先要安装这个gem：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install mechanize</span><br></pre></td></tr></table></figure>
<p>实现模拟登录思路如下：</p>
<ol>
<li>生成一个实例对象agent</li>
<li>获取页面对象login_page</li>
<li>获取该页面的表单对象login_form</li>
<li>填入账号密码(可预设在代码里)</li>
<li>下载验证码到本地</li>
<li>瞄一眼验证码</li>
<li>人工输入验证码</li>
<li>开始尝试登录，得到session就可以为所欲为了</li>
</ol>
<p>步骤大约如上8步，写出来的代码也不过十几行，Ruby就这么省心。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">"mechanize"</span> <span class="comment">#引入Mechanize</span></span><br><span class="line">agent = Mechanize.new <span class="comment">#新建一个Mechanize对象</span></span><br><span class="line">login_page = agent.get <span class="string">"http://202.119.113.135/loginAction.do"</span> <span class="comment">#获取登录页面</span></span><br><span class="line">login_form = login_page.forms[<span class="number">0</span>]  <span class="comment">#获取该页面第一个表单（因为一个页面可能会有很多个表单，所以是数组）</span></span><br><span class="line"></span><br><span class="line">username_field = login_form.field_with(<span class="symbol">:name</span> =&gt; <span class="string">"zjh"</span>)  <span class="comment">#获取name为zjh的输入框</span></span><br><span class="line">username_field.value = <span class="string">"这里填学号"</span>          <span class="comment">#填上账户名，即学号（下同）</span></span><br><span class="line">password_field = login_form.field_with(<span class="symbol">:name</span> =&gt; <span class="string">"mm"</span>)</span><br><span class="line">password_field.value = <span class="string">"这里填密码"</span></span><br><span class="line"></span><br><span class="line">v_code = agent.get <span class="string">"http://202.119.113.135/validateCodeAction.do?random=0.27"</span> <span class="comment">#下载验证码</span></span><br><span class="line">v_code.save! <span class="string">"validateCode.jpg"</span>  <span class="comment">#保存验证码图片</span></span><br><span class="line">print <span class="string">"请输入验证码:\n"</span></span><br><span class="line">v_input = gets.chomp   <span class="comment">#手动输入验证码</span></span><br><span class="line">code_field = login_form.field_with(<span class="symbol">:name</span> =&gt; <span class="string">"v_yzm"</span>) <span class="comment">#获取name为yzm的输入框</span></span><br><span class="line">code_field.value = v_input      <span class="comment">#输入验证码</span></span><br><span class="line"></span><br><span class="line">agent.submit login_form         <span class="comment">#提交表单</span></span><br><span class="line">print <span class="string">"正在登录...\n"</span></span><br></pre></td></tr></table></figure>
<p>一般来说到这里就会登陆成功了，但你好像并不知道有没有成功。</p>
<p>我们需要对这个结果进行判断，提交了表单以后，可以通过分析返回页面是否包含”验证码错误”、”密码不正确”之类的字符串，来判定是否登录成功。实际上更加合理的方式是判断能否访问登陆后才可以访问的页面，不过这里可以这样简单处理，不算优雅，也不算很hack。</p>
<p>通过分析验证码错误的页面源码，可以发现如下片段：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/img/icon/alert.gif"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"errorTop"</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#990000"</span>&gt;</span>你输入的验证码错误，请您重新输入！<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这一段的文字可以从</p>
<blockquote>
<p>class=”errorTop”</p>
</blockquote>
<p>这一句进行捕捉，利用Nokogiri自带的选择器</p>
<blockquote>
<p>page.css(“.errorTop”)</p>
</blockquote>
<p>就可以得到那个td标签的Nokogiri对象，其子对象strong标签的子对象font标签的元素内容才是我们想要的信息。<br>所以代码如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">loop <span class="keyword">do</span></span><br><span class="line">  v_code = agent.get <span class="string">"http://202.119.113.135/validateCodeAction.do?random=0.66666666666666666"</span></span><br><span class="line">  v_code.save! <span class="string">"validateCode.jpg"</span></span><br><span class="line">  <span class="comment">#手动输入验证码</span></span><br><span class="line">  print <span class="string">"请输入验证码:\n"</span></span><br><span class="line">  v_input = gets.chomp</span><br><span class="line">  code_field = login_form.field_with(<span class="symbol">:name</span> =&gt; <span class="string">"v_yzm"</span>)</span><br><span class="line">  code_field.value = v_input</span><br><span class="line">  <span class="comment">#提交表单 并把结果赋值给变量result_page</span></span><br><span class="line">  result_page = agent.submit login_form</span><br><span class="line">  print <span class="string">"正在登录...\n"</span></span><br><span class="line">  <span class="comment">#通过Nokogiri的parser方法得到整个页面的Nokogiri对象们，并且转成字符串，编码为UTF-8，以便后续判断</span></span><br><span class="line">  result_text = result_page.parser.to_s.encode(<span class="string">"UTF-8"</span>)</span><br><span class="line">  <span class="keyword">if</span> result_text.<span class="keyword">include</span>?(<span class="string">"密码不正确"</span>)</span><br><span class="line">    <span class="comment">#这个Nokogiri的子对象的子对象的子对象的文本就是错误信息。我也不想把代码写这么丑，但这破网站真的好喜欢嵌套</span></span><br><span class="line">    puts result_page.css(<span class="string">".errorTop"</span>).children.children.children.text</span><br><span class="line">    <span class="comment">#因为这里是预设在源码里的账号密码，如果错了就关闭程序，修改源码</span></span><br><span class="line">    puts <span class="string">"请检查预设账号与密码"</span></span><br><span class="line">    puts <span class="string">"登录失败"</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">elsif</span> result_text.<span class="keyword">include</span>?(<span class="string">"验证码错误"</span>)</span><br><span class="line">    puts result_page.css(<span class="string">".errorTop"</span>).children.children.children.text</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"登陆成功"</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>从下载验证码，到登录是否成功，这段代码构成一个循环，直到成功登录为止。所以可以直接loop循环到死，啊不，肯定会有结果的。</p>
<p>到这里，我们已经可以模拟登录教务系统，并且可以判断是否登录成功，验证码错误的话，再次循环，直到成功。(这里是为了之后的OCR自动识别验证码做个铺垫，因为自动识别的成功率不是100，所以自动循环再尝试，对于机器来说，很理所当然了。)</p>
<h2 id="自动识别验证码"><a href="#自动识别验证码" class="headerlink" title="自动识别验证码"></a>自动识别验证码</h2><hr>
<h3 id="可行性"><a href="#可行性" class="headerlink" title="可行性"></a>可行性</h3><p><img src="http://upload-images.jianshu.io/upload_images/703144-36f8e0615e112670.do?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="验证码"></p>
<p>就这破验证码，绝对可行。</p>
<h3 id="安装RTesseract"><a href="#安装RTesseract" class="headerlink" title="安装RTesseract"></a>安装RTesseract</h3><p>终于到了懒人必备的步骤了，既然我都花时间研究学校网站的破代码了，还让我自己输验证码这不白搭吗？</p>
<p>显然懒才会懒出高效率，接下来就该上自动识别验证码的功能了。</p>
<ol>
<li><p>安装 tesseract-ocr</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tesseract-ocr</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装RTesseract gem</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install rtesseract</span><br><span class="line">sudo gem install mini_magick</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>因为RTesseract需要依赖Rmagick才能处理图像，这里用MiniMagick替代它，原因是：传说Rmagick会泄露内存，不知道后续版本有没有修复，不管怎么说，mini版的轻量些也没什么坏处。<br><strong>注：可能还需要别的依赖，笔者已经记不太清了，想起再添加说明。遇到报错就Google之。</strong></p>
<ol start="3">
<li>下载识别训练的数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从Google官网下载</span></span><br><span class="line">wget https://tesseract-ocr.googlecode.com/files/eng.traineddata.gz</span><br><span class="line"><span class="comment">#下载完成后，移动到相应文件夹，可选择/usr或者/opt</span></span><br><span class="line">sudo mv -v eng.traineddata /usr/<span class="built_in">local</span>/share/tessdata/</span><br><span class="line"><span class="comment">#sudo mv -v eng.traineddata /opt/local/share/tessdata/</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="OCR识别"><a href="#OCR识别" class="headerlink" title="OCR识别"></a>OCR识别</h3><p>我们在刚刚的代码前面加上</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'rtesseract'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'mini_magick'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">identify</span><span class="params">(path=<span class="string">"validateCode.jpg"</span>)</span></span></span><br><span class="line">  image = RTesseract.new(path, <span class="symbol">processor:</span> <span class="string">"mini_magick"</span>)</span><br><span class="line">  image.to_s</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>并且把原来的手动输入直接干掉，改为调用identify方法。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v_input = gets.chomp</span></span><br><span class="line">v_input = identify(<span class="string">"validateCode.jpg"</span>)</span><br></pre></td></tr></table></figure>
<p>这样一来，由identify方法接受图片路径参数，经过识别得到字符串返回，直接赋值给v_input，省去了人工输入的麻烦。</p>
<p>不过识别率有待提高，我们可以针对性的提高识别率。</p>
<h3 id="提高识别率"><a href="#提高识别率" class="headerlink" title="提高识别率"></a>提高识别率</h3><hr>
<h4 id="干掉空格"><a href="#干掉空格" class="headerlink" title="干掉空格"></a>干掉空格</h4><p>有时候会识别出多余的空格，然而验证码是不可能需要空格的，所以我们要干掉所有的空格</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#image.to_s</span></span><br><span class="line">image.to_s.gsub(<span class="string">' '</span>,<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h4 id="限定识别范围"><a href="#限定识别范围" class="headerlink" title="限定识别范围"></a>限定识别范围</h4><p>然而默认的还可能识别出标点符号甚至美元符号等，经测试，这甚至会导致循环异常中断，懒得追究原因，直接干掉这些不需要的符号。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># image = RTesseract.new(path, processor: "mini_magick")</span></span><br><span class="line">image = RTesseract.new(path, <span class="symbol">processor:</span> <span class="string">"mini_magick"</span>,<span class="symbol">options:</span>[<span class="symbol">:validcode</span>])</span><br></pre></td></tr></table></figure>
<p>这里增加了一个选项，一般默认在下面路径里会有个digits的文件(注意：<strong>没有后缀名</strong>)</p>
<blockquote>
<p>/usr/local/share/tessdata/configs</p>
</blockquote>
<p>里面的内容是这样的：</p>
<blockquote>
<p>tessedit_char_whitelist 0123456789-.</p>
</blockquote>
<p>而它的作用就是，让识别的结果限定在数字、连字符、小数点范围内。抱着试一试的态度，我新建了一个叫validcode的文件，写了如下内容：</p>
<blockquote>
<p>tessedit_char_whitelist 0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM</p>
</blockquote>
<p>当然了，it works!结果就是识别出来的结果仅由字母和数字组成，大大提高识别正确率。(实际上后来我想起，学校的验证码故意没有字母O的，怕看错吧，也算走点心了…)</p>
<h4 id="判定长度"><a href="#判定长度" class="headerlink" title="判定长度"></a>判定长度</h4><p>还有个地方可以改进，它并不总是会识别出来四个字符，但验证码确实永远是四个字符，所以我们可以做个判断，当识别出来字符长度不是四位，就直接跳过，节约一点时间。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">next</span> <span class="keyword">if</span> v_input.length != <span class="number">4</span></span><br></pre></td></tr></table></figure>
<h4 id="处理图像"><a href="#处理图像" class="headerlink" title="处理图像"></a>处理图像</h4><p>这里我没有对图像进行任何处理，实际上还可以进行二值化，去噪点等等，不过识别率已经很高了，我就没再折腾了。有兴趣的读者可以试试，毕竟不是所有的验证码，都像我们学校这么<del>容易</del>难以识别。</p>
<p>(PS: 由于登录功能已经可以分辨密码错误还是验证码错误，并且可以循环，所以顺便改造成了暴力破解密码的程序。一般密码都是身份证后六位，我知道十几个同学的密码，全都没改过。密码前两个数字是01~31，后面就直接递增暴搜，还要额外考虑X结尾的情况。具体代码不贴了，效率差不多平均0.6秒跑一个密码。可以理解为如果知道对方生日，并且对方没改过密码，暴搜一万次大约6000s，俩小时之内就能跑完…)</p>
<h2 id="获取成绩"><a href="#获取成绩" class="headerlink" title="获取成绩"></a>获取成绩</h2><hr>
<h3 id="获取指定页面"><a href="#获取指定页面" class="headerlink" title="获取指定页面"></a>获取指定页面</h3><p>我们先分析浏览器中的页面<br><img src="http://upload-images.jianshu.io/upload_images/703144-3953f4c8e829631e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="全部成绩界面"><br>这就是最恶心的地方了，整个网页由好几个frame组成，分别为侧边栏，顶部菜单栏等等。在不同的frame里document是异步加载，想刷新成绩只需要多点几下按钮，千万不能按F5，不然它会判定你再次提交表单登录，然而验证码已刷新，所以会报错验证码错误，这鬼畜的逻辑也是感人。多说一句，页面真是丑到令人发指。</p>
<p>不过也得接着分析，好在Mechanize有相对应的API，可以直接模拟点击frame，这样一来，就很容易找到我们需要的东西了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/703144-43080726aa4c18d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="frameset结构"></p>
<p>分析这个地方可以得到，显示<strong>全部及格成绩</strong>的网址是</p>
<blockquote>
<p><a href="http://202.119.113.135/gradeLnAllAction.do?type=ln&amp;oper=qb" target="_blank" rel="noopener">http://202.119.113.135/gradeLnAllAction.do?type=ln&amp;oper=qb</a></p>
</blockquote>
<p>所以我们访问该网址，并模拟点击一次<strong>全部及格成绩</strong>链接，就可以获得成绩表格。<br>代码如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logged_page = agent.get(<span class="string">"http://202.119.113.135/gradeLnAllAction.do?type=ln&amp;oper=qb"</span>)</span><br><span class="line">score_page = logged_page.iframe.click</span><br><span class="line">score_page.save! <span class="string">"score.html"</span></span><br></pre></td></tr></table></figure>
<h3 id="解析结果"><a href="#解析结果" class="headerlink" title="解析结果"></a>解析结果</h3><p>成绩已经下载到本地了，用浏览器打开就可以看得到。只是几个学期的成绩表格的话，解析起来很简单啦，顺便写个绩点计算功能也是分分钟，还顺便可选择要不要算选修课，是计算本学期还是计算大学生涯，自定义格式表现出来都可以！梦想总是美好的，然而！</p>
<p><strong>Too young！Too simple！Sometimes naive！</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/703144-7809414fe916bdfd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="成绩表格的一小部分的一小部分"><br>我了个草啊，我尝试了半天如何批量获取成绩tr，每行作为一个对象，存到数组，调用起来怎么计算都行。但是这个结构！！谁能告诉我为什么一个学期的成绩要6个表格！还特么互相嵌套！其中就一个表格占空间！也许是为了兼容视图的hack，那你倒是别在成绩table中穿插没用tr啊！我试图寻找所有成绩tr的共性，试图通过style.class来选择，然后我又发现诡异的事情了！每个行鼠标路过一下class值就变了…心好累…我真是没兴趣继续下去了，这个网站，分析起来像<strong>吃了shi一样难受！</strong></p>
<p><del>不玩了。</del></p>
<p><del>未完不续，一秒也不续了！</del></p>
<p>不玩了那就不是我pujiaxun了！</p>
<p>一小时后我又回来更新文章了。</p>
<p>嘴上说不要，但是心里不爽啊，还是尝试着分析了一下。</p>
<p>我发现页面tr元素的style.class会从odd变成even，是由于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onmouseout=&quot;this.className=&apos;even&apos;;&quot;</span><br></pre></td></tr></table></figure>
<p>由此推测可能是被鼠标滑过的成绩会有别的五毛特效吧，不必追究，一毛都嫌多，用代码解析的时候并不会有鼠标掠过的操作。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page = Nokogiri::HTML(open(<span class="string">"score.html"</span>).read,<span class="literal">nil</span>,<span class="string">"gbk"</span>)</span><br></pre></td></tr></table></figure>
<p>由于教务系统蛋疼地用了gbk编码…所以需要加个参数，以便正常解析。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subjects = page.css(<span class="string">"tr.odd"</span>)</span><br></pre></td></tr></table></figure>
<p>这句话类似jQuery选择器，可以得到所有class=”odd”的tr元素，即我们需要的所有成绩。</p>
<p>可是如何得到每个数据呢？</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p subjects[<span class="number">1</span>].children</span><br></pre></td></tr></table></figure>
<p>得到如下乱七八糟的东西：<br><img src="http://upload-images.jianshu.io/upload_images/703144-8834db5d816f52f9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="subject的孩子们"><br>这太乱了，数了一下，大概第五个元素有点卵用，来看看第5个children里的text吧</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p subjects[<span class="number">1</span>].children[<span class="number">5</span>].text.strip</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通信工程新技术</p>
</blockquote>
<p>太好了！是课程名字！同理我们可以看看都有哪些数据</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subjects[<span class="number">1</span>].children.each <span class="keyword">do</span> <span class="params">|c|</span></span><br><span class="line">    p c.text.strip</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>“”<br>“0602030”<br>“”<br>“01”<br>“”<br>“通信工程新技术”<br>“”<br>“New technology in Communication Engineering”<br>“”<br>“1”<br>“”<br>“选修”<br>“”<br>“80.0 “<br>“”</p>
</blockquote>
<p>由此可知第5个是课程名，第7个是英文课程名，以此类推。</p>
<p>所以我们可以处理打包了：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_point</span> <span class="params">(grade)</span></span></span><br><span class="line">  s = grade.to_i</span><br><span class="line">  <span class="comment">#如果是文字</span></span><br><span class="line">  <span class="keyword">if</span> s == <span class="number">0</span></span><br><span class="line">    <span class="keyword">case</span> grade</span><br><span class="line">    <span class="keyword">when</span> <span class="string">"优秀"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"5"</span></span><br><span class="line">    <span class="keyword">when</span> <span class="string">"良好"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"4"</span></span><br><span class="line">    <span class="keyword">when</span> <span class="string">"中等"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"3"</span></span><br><span class="line">    <span class="keyword">when</span> <span class="string">"及格"</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"2"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"0"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment">#如果是数字</span></span><br><span class="line">  <span class="keyword">if</span> s&lt;<span class="number">60</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"0"</span></span><br><span class="line">  <span class="keyword">elsif</span> s&gt;=<span class="number">90</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"5"</span></span><br><span class="line">  <span class="keyword">elsif</span> (s&gt;=<span class="number">60</span> &amp;&amp; s&lt;<span class="number">90</span>)</span><br><span class="line">    <span class="keyword">return</span> (((s-<span class="number">60</span>)/<span class="number">5</span>)*<span class="number">0</span>.<span class="number">5</span>+<span class="number">2.0</span>).to_s</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"fuck"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">scorelist = []</span><br><span class="line">subjects.each <span class="keyword">do</span> <span class="params">|m|</span></span><br><span class="line">  subject = &#123;&#125;</span><br><span class="line">  subject[<span class="string">"name"</span>] = m.children[<span class="number">5</span>].text.strip</span><br><span class="line">  subject[<span class="string">"eng_name"</span>] = m.children[<span class="number">7</span>].text.strip</span><br><span class="line">  subject[<span class="string">"credit"</span>] = m.children[<span class="number">9</span>].text.strip</span><br><span class="line">  subject[<span class="string">"prop"</span>] = m.children[<span class="number">11</span>].text.strip</span><br><span class="line">  subject[<span class="string">"grade"</span>] = m.children[<span class="number">13</span>].text.strip.slice!(<span class="number">0</span>..-<span class="number">2</span>)<span class="comment"># 鬼畜的空白字符</span></span><br><span class="line">  subject[<span class="string">"point"</span>] = get_point subject[<span class="string">"grade"</span>]</span><br><span class="line">  scorelist &lt;&lt; subject</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>新建一个scorelist数组，用来存放所有的学科成绩。每行数据包括课程名、学分、得分等，绩点是利用get_point方法实时计算出来，打包好数据，压进数组。其中非常蛋疼的是成绩字符串末尾有个空白字符，大概是<strong>nbsp</strong>，strip方法无效。只好使用slice去掉最后一个字符。</p>
<p>至此，我们已经把数据拿到，并且构建了合适的数据结构。如果想要计算绩点，就很简单了，比如下面的方法：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_GPA</span> <span class="params">(scorelist,only=<span class="literal">true</span>)</span></span></span><br><span class="line">  sum_point = <span class="number">0</span></span><br><span class="line">  sum_credit = <span class="number">0</span></span><br><span class="line">  scorelist.each <span class="keyword">do</span> <span class="params">|s|</span></span><br><span class="line">    <span class="keyword">if</span>  ((s[<span class="string">"prop"</span>]!=<span class="string">"选修"</span>) <span class="params">||</span> (only==<span class="literal">false</span>)) <span class="comment">#only参数为真时只统计必修课程，为假则全部统计</span></span><br><span class="line">      sum_point += s[<span class="string">"point"</span>].to_f * s[<span class="string">"credit"</span>].to_f</span><br><span class="line">      sum_credit += s[<span class="string">"credit"</span>].to_f</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  (sum_point/sum_credit).round(<span class="number">3</span>) <span class="comment">#保留三位小数</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>整理一下，整体效果差不多这样子：<br><img src="http://upload-images.jianshu.io/upload_images/703144-242a54e050b69b70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="还好前面几个成绩看的过去..."><br>最艰难的时刻都度过了，想要继续爬点有用的信息也就很简单了。不过还是想对这个教务系统说，再见！</p>
<p>这次历险记中，收获还是蛮大的，写出来的时候都是在事后，所以比较简略，但篇幅也不小。这个东西确实折磨我好些天了，期间了解了解析HTML的思路，模拟登录的注意事项，识别字符的效率如何提高等等。很多事情看别人说的简单，真的投入进去才明白需要处理的细节太多了，可能光是使用Tesseract时遇到缺少训练数据、缺少依赖、path配置各种问题，就足够打倒很多人。</p>
<p>可是编程最有趣地方的就在这里了。</p>
<p><a href="https://github.com/pujiaxun/hack_my_school" target="_blank" rel="noopener">GitHub项目地址</a></p>
</div><iframe src="/donate/?AliPayQR=/img/AliPayQR.jpg&amp;WeChatQR=/img/WeChatQR.jpg&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div class="tags"><a href="/tags/Ruby/">Ruby</a><a href="/tags/爬虫/">爬虫</a></div><div class="post-nav"><a class="pre" href="/2016/04/11/5/">说说自己</a><a class="next" href="/2016/03/27/2/">JS实现Alphabet Challenge</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'GdYXc7NL6OjXbEsEJpbupajS-gzGzoHsz',
  appKey:'V1O9dvhLxl0T3bC1aVN9TrUC',
  placeholder:'坐下说坐下说...',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.pujiaxun.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/面试/" style="font-size: 15px;">面试</a> <a href="/tags/实习/" style="font-size: 15px;">实习</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/English/" style="font-size: 15px;">English</a> <a href="/tags/闲谈/" style="font-size: 15px;">闲谈</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/LaTeX/" style="font-size: 15px;">LaTeX</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/效率/" style="font-size: 15px;">效率</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a> <a href="/tags/经济学/" style="font-size: 15px;">经济学</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/51/">从z-index到层叠上下文</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/28/50/">图片视频瀑布流长列表性能优化实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/25/49/">图片预加载踩坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/25/48/">Webpack热更新内存泄漏探索</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/09/47/">Chrome中sticky定位的导航栏产生1px缝隙</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/18/46/">我是如何提高生存效率的</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/10/45/">Neo4j & Python 构建中国行政区划图</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/13/43/">快速排序算法原来这么简单</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/01/42/">macOS 中文输入法时 VS Code 快捷键失效</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/25/41/">如何区别真假网址？</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Pujiaxun的空间.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.1.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.1.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.1.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.1.0"></script></div></body></html>